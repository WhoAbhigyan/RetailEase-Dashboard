<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Smart Kiosk (India)</title>
<style>
:root { --bg:#0f172a; --panel:#111827; --text:#e5e7eb; --muted:#94a3b8; --brand:#16a34a; --warn:#f59e0b; }
* { box-sizing: border-box; }
body { margin:0; font-family: system-ui, Segoe UI, Roboto, sans-serif; background: var(--bg); color: var(--text); }
a { color: var(--text); text-decoration: none; margin-right: 12px; }
.topnav { display:flex; align-items:center; justify-content:space-between; padding:12px 16px; border-bottom:1px solid #1f2937; position: sticky; top:0; background: var(--bg); z-index: 10;}
.brand { font-weight:700; color: var(--brand); }
.content { padding: 16px; max-width: 1200px; margin: 0 auto; }
.page h2 { margin: 12px 0 16px; }
.grid { display:grid; gap:12px; }
.grid.stats { grid-template-columns: repeat(3, minmax(0, 1fr)); }
.grid.products { grid-template-columns: repeat(2, minmax(0, 1fr)); }
.panel { background: var(--panel); padding: 16px; border-radius: 8px; }
.row { display:flex; gap:8px; align-items:center; flex-wrap: wrap; }
.row.between { justify-content: space-between; }
.row.end { justify-content: flex-end; }
.table { width:100%; border-collapse: collapse; }
.table th, .table td { padding:8px; border-bottom: 1px solid #1f2937; text-align: left; }
.table tr.warn { background: rgba(245,158,11,0.1); }
input, select, button { padding:10px 12px; border-radius:6px; border:1px solid #1f2937; background:#0b1220; color: var(--text); }
button { background: var(--brand); border:none; cursor:pointer; color:#08110a; font-weight:600; }
.card { border:1px solid #1f2937; border-radius:8px; padding:10px; }
.name { font-weight:600; }
.stat-card { background:#0b1220; border:1px solid #1f2937; border-radius:8px; padding:12px; }
.stat-label { color: var(--muted); font-size: 12px; }
.stat-value { font-size: 20px; font-weight: 700; margin-top: 4px; }
.modal { position: fixed; inset:0; background: rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; padding:16px; }
.form input, .form select, .form textarea { width:100%; margin-bottom:10px; }
.mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; word-break: break-all; margin-top: 8px; color: var(--muted); }
.badge { padding: 2px 8px; border-radius: 999px; font-size: 12px; background: #0b1220; border: 1px solid #1f2937; }
footer { text-align: center; padding: 24px; color: var(--muted); }
hr { border: none; border-top: 1px solid #1f2937; margin: 16px 0; }
@media (min-width: 900px) {
  .grid.products { grid-template-columns: repeat(3, minmax(0, 1fr)); }
}
</style>
</head>
<body>
<div id="root"></div>

<!-- React + Babel for single-file JSX -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<!-- Chart.js for analytics -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- QRCode (dataURL generator) -->
<script src="https://unpkg.com/qrcode/build/qrcode.min.js"></script>

<script type="text/babel">
/* ====== Utilities ====== */

// INR formatting using Intl API (en-IN)
const formatINR = (amount) =>
  new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 2 }).format(Number(amount||0));

// Date helpers
const todayISO = () => new Date().toISOString().slice(0,10);
const parseDate = (s) => new Date(s);
const isSameDay = (a,b) => {
  const da = parseDate(a), db = parseDate(b);
  return da.getFullYear()===db.getFullYear() && da.getMonth()===db.getMonth() && da.getDate()===db.getDate();
};
const daysAgo = (n) => {
  const d = new Date();
  d.setDate(d.getDate()-n);
  return d;
};
const isInLastNDays = (dateStr, n) => parseDate(dateStr) >= daysAgo(n);

/* ====== Local Storage “DB” ====== */
const DB_KEYS = {
  owner: 'sk_owner',
  products: 'sk_products',
  sales: 'sk_sales',
  auth: 'sk_auth'
};

const loadJSON = (k, fallback) => {
  try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : fallback; } catch { return fallback; }
};
const saveJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));

/* ====== GST Helpers (India) ====== */
// Defaults: 5%, 18%, 40% (sin/luxury), configurable per item/category
const CATEGORY_DEFAULTS = {
  'Food & Beverages': 0.05,
  'Bakery': 0.05,
  'Groceries': 0.05,
  'Personal Care': 0.18,
  'Household': 0.18,
  'Electronics': 0.18,
  'Luxury/Sin': 0.40
};
const resolveGstRate = (product, owner) => {
  const ownerDefault = Number(owner?.defaultGstRate ?? 0.18);
  if (typeof product?.gstRate === 'number') return product.gstRate;
  const catMap = owner?.categoryGstMap || {};
  const catRate = catMap[product?.category] ?? CATEGORY_DEFAULTS[product?.category];
  return typeof catRate === 'number' ? catRate : ownerDefault;
};
const lineTotals = (price, qty, rate) => {
  const sub = price * qty;
  const gst = sub * rate;
  return { sub, gst, total: sub + gst };
};
const cartTotals = (lines, owner) => {
  let subTotal=0, gst=0, grandTotal=0;
  for (const l of lines) {
    const price = Number(l.overridePrice ?? l.product.price);
    const rate = resolveGstRate(l.product, owner);
    const r = lineTotals(price, l.qty, rate);
    subTotal += r.sub; gst += r.gst; grandTotal += r.total;
  }
  return { subTotal, gst, grandTotal };
};

/* ====== UPI Intent Builder ====== */
// Builds upi://pay link; QR will encode this deep link for UPI apps
const buildUpiIntent = ({ pa, pn, am, tn }) => {
  const params = new URLSearchParams({
    pa, pn, am: String(am ?? 0), cu: 'INR', tn: tn || 'Payment'
  });
  return `upi://pay?${params.toString()}`;
};

/* ====== App State (Simple) ====== */
function useDb() {
  const [owner, setOwner] = React.useState(() => loadJSON(DB_KEYS.owner, {
    shopName: 'My Shop', phone: '', gstNumber: '', defaultGstRate: 0.18, upiVpa: ''
  }));
  const [products, setProducts] = React.useState(() => loadJSON(DB_KEYS.products, []));
  const [sales, setSales] = React.useState(() => loadJSON(DB_KEYS.sales, []));
  const [auth, setAuth] = React.useState(() => loadJSON(DB_KEYS.auth, { isAuthed: false }));

  React.useEffect(() => saveJSON(DB_KEYS.owner, owner), [owner]);
  React.useEffect(() => saveJSON(DB_KEYS.products, products), [products]);
  React.useEffect(() => saveJSON(DB_KEYS.sales, sales), [sales]);
  React.useEffect(() => saveJSON(DB_KEYS.auth, auth), [auth]);

  return { owner, setOwner, products, setProducts, sales, setSales, auth, setAuth };
}

/* ====== Components ====== */

function TopNav({ route, setRoute, shopName }) {
  return (
    <div className="topnav">
      <div className="brand">{shopName || 'Smart Kiosk'}</div>
      <nav className="row">
        <a href="#" onClick={(e)=>{e.preventDefault(); setRoute('dashboard')}}>Dashboard</a>
        <a href="#" onClick={(e)=>{e.preventDefault(); setRoute('products')}}>Products</a>
        <a href="#" onClick={(e)=>{e.preventDefault(); setRoute('billing')}}>Billing</a>
        <a href="#" onClick={(e)=>{e.preventDefault(); setRoute('reports')}}>Reports</a>
        <a href="#" onClick={(e)=>{e.preventDefault(); setRoute('settings')}}>Settings</a>
      </nav>
    </div>
  );
}

function StatCard({label, value}) {
  return (
    <div className="stat-card">
      <div className="stat-label">{label}</div>
      <div className="stat-value">{value}</div>
    </div>
  );
}

function Login({ onLogin }) {
  const [phone,setPhone] = React.useState('');
  const [password,setPassword] = React.useState('');
  const submit = (e) => { e.preventDefault(); onLogin({ phone, password }); };
  return (
    <div className="content">
      <div className="page">
        <h2>Owner Login</h2>
        <form onSubmit={submit} className="panel form">
          <input placeholder="Phone" value={phone} onChange={e=>setPhone(e.target.value)} required />
          <input placeholder="Password" type="password" value={password} onChange={e=>setPassword(e.target.value)} required />
          <div className="row end"><button type="submit">Login</button></div>
          <div className="mono">Demo hint: any phone/password will work in this single-file demo.</div>
        </form>
      </div>
    </div>
  );
}

function Dashboard({ sales }) {
  // Today’s metrics and last 7 days trend
  const today = todayISO();
  const todaySales = sales.filter(s => isSameDay(s.date, today));
  const totalToday = todaySales.reduce((a,s)=>a+s.totals.grandTotal,0);
  const itemsToday = todaySales.reduce((a,s)=>a+s.lines.reduce((x,l)=>x+l.qty,0),0);
  const gstToday = todaySales.reduce((a,s)=>a+s.totals.gst,0);

  // Build last 7 days data
  const days = [...Array(7)].map((_,i)=> {
    const d = daysAgo(6-i);
    const iso = d.toISOString().slice(0,10);
    const label = d.toLocaleDateString('en-IN', { day: '2-digit', month: 'short' });
    const daySales = sales.filter(s => isSameDay(s.date, iso));
    const total = daySales.reduce((a,s)=>a+s.totals.grandTotal,0);
    return { label, total };
  });

  React.useEffect(() => {
    const ctx = document.getElementById('trendChart');
    if (!ctx) return;
    if (window._chart) { window._chart.destroy(); window._chart = null; }
    window._chart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: days.map(d=>d.label),
        datasets: [{ label: "Sales (₹)", data: days.map(d=>d.total), borderColor: '#16a34a', tension: 0.35 }]
      },
      options: { responsive: true, plugins: { legend:{display:false} } }
    });
  }, [sales]);

  return (
    <div className="content">
      <div className="page">
        <h2>Dashboard</h2>
        <div className="grid stats">
          <StatCard label="Today's Sales" value={formatINR(totalToday)} />
          <StatCard label="Items Sold" value={itemsToday} />
          <StatCard label="GST Collected" value={formatINR(gstToday)} />
        </div>
        <div className="panel" style={{marginTop:12}}>
          <h3>Sales Trend (7 Days)</h3>
          <canvas id="trendChart" height="120"></canvas>
        </div>
      </div>
    </div>
  );
}

function Products({ products, setProducts }) {
  const [query,setQuery] = React.useState('');
  const [modal, setModal] = React.useState({ open:false, data:null });

  const filtered = React.useMemo(()=>{
    const q=query.trim().toLowerCase();
    return q ? products.filter(p => (p.name?.toLowerCase().includes(q) || p.category?.toLowerCase().includes(q))) : products;
  },[products,query]);

  const onSave = (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const payload = Object.fromEntries(fd.entries());
    payload.price = Number(payload.price);
    payload.stock = Number(payload.stock);
    payload.gstRate = payload.gstRate ? Number(payload.gstRate) : undefined;
    if (modal.data?.id) {
      setProducts(products.map(p => p.id===modal.data.id ? {...modal.data, ...payload} : p));
    } else {
      const id = products.length ? Math.max(...products.map(p=>p.id))+1 : 1;
      setProducts([{ id, ...payload }, ...products]);
    }
    setModal({ open:false, data:null });
  };
  const onDelete = (id) => setProducts(products.filter(p=>p.id!==id));

  return (
    <div className="content">
      <div className="page">
        <div className="row between">
          <h2>Products</h2>
          <div className="row">
            <input placeholder="Search name/category" value={query} onChange={e=>setQuery(e.target.value)} />
            <button onClick={()=>setModal({ open:true, data:null })}>Add Product</button>
          </div>
        </div>

        <table className="table panel">
          <thead><tr>
            <th>Name</th><th>Category</th><th>Price (₹)</th><th>Stock</th><th>GST %</th><th></th>
          </tr></thead>
          <tbody>
            {filtered.map(p=>(
              <tr key={p.id} className={p.stock<5?'warn':''}>
                <td>{p.name}</td>
                <td>{p.category}</td>
                <td>{Number(p.price).toFixed(2)}</td>
                <td>{p.stock} {p.stock<5 && <span className="badge" title="Low stock">Low</span>}</td>
                <td>{typeof p.gstRate==='number' ? (p.gstRate*100).toFixed(0) : '-'}</td>
                <td>
                  <button onClick={()=>setModal({ open:true, data:p })}>Edit</button>
                  <button onClick={()=>onDelete(p.id)}>Delete</button>
                </td>
              </tr>
            ))}
            {!filtered.length && <tr><td colSpan="6">No products</td></tr>}
          </tbody>
        </table>

        {modal.open && (
          <div className="modal" onClick={()=>setModal({open:false,data:null})}>
            <form className="panel form" onClick={(e)=>e.stopPropagation()} onSubmit={onSave}>
              <h3>{modal.data ? 'Edit Product' : 'Add Product'}</h3>
              <input name="name" defaultValue={modal.data?.name||''} placeholder="Name" required />
              <input name="category" defaultValue={modal.data?.category||''} placeholder="Category" required />
              <input name="price" type="number" step="0.01" defaultValue={modal.data?.price??''} placeholder="Price (₹)" required />
              <input name="stock" type="number" defaultValue={modal.data?.stock??0} placeholder="Stock Qty" required />
              <input name="gstRate" type="number" step="0.01" defaultValue={modal.data?.gstRate??''} placeholder="GST Rate e.g. 0.05 or 0.18 (optional)" />
              <div className="row end">
                <button type="button" onClick={()=>setModal({open:false,data:null})}>Cancel</button>
                <button type="submit">Save</button>
              </div>
            </form>
          </div>
        )}
      </div>
    </div>
  );
}

function Billing({ owner, products, setProducts, sales, setSales }) {
  const [cart, setCart] = React.useState([]);
  const [mode, setMode] = React.useState('CASH');
  const [query, setQuery] = React.useState('');
  const [qrDataUrl, setQrDataUrl] = React.useState(null);
  const [upiIntent, setUpiIntent] = React.useState(null);

  const filtered = React.useMemo(()=>{
    const q=query.trim().toLowerCase();
    return q ? products.filter(p => (p.name?.toLowerCase().includes(q) || p.category?.toLowerCase().includes(q))) : products;
  },[products,query]);

  const totals = React.useMemo(()=>cartTotals(cart.map(l=>({
      product: l.product,
      qty: l.qty,
      overridePrice: l.overridePrice
    })), owner), [cart, owner]);

  const addToCart = (p) => {
    setQrDataUrl(null); setUpiIntent(null);
    setCart(prev => {
      const i = prev.findIndex(l=>l.product.id===p.id);
      if (i>=0) {
        const copy=[...prev]; copy[i]={...copy[i], qty: copy[i].qty+1}; return copy;
      }
      return [...prev, { product: p, qty:1, overridePrice: null }];
    });
  };
  const setQty = (pid, qty) => {
    setQrDataUrl(null); setUpiIntent(null);
    setCart(prev => prev.map(l=>l.product.id===pid ? {...l, qty: Math.max(1, Number(qty)||1)} : l));
  };
  const removeLine = (pid) => {
    setQrDataUrl(null); setUpiIntent(null);
    setCart(prev => prev.filter(l=>l.product.id!==pid));
  };
  const clearCart = () => { setCart([]); setQrDataUrl(null); setUpiIntent(null); };

  const checkout = async () => {
    if (!cart.length) return;
    // Decrement stock
    const nextProducts = products.map(p => {
      const line = cart.find(l=>l.product.id===p.id);
      return line ? {...p, stock: Math.max(0, Number(p.stock)-Number(line.qty))} : p;
    });
    setProducts(nextProducts);

    // Build sale record
    const id = sales.length ? Math.max(...sales.map(s=>s.id))+1 : 1;
    const sale = {
      id, date: todayISO(), lines: cart.map(l => ({
        productId: l.product.id, name: l.product.name, price: Number(l.overridePrice ?? l.product.price), qty: l.qty,
        gstRate: resolveGstRate(l.product, owner)
      })), totals, paymentMode: mode, invoiceNo: `INV-${String(id).padStart(5,'0')}`
    };
    setSales([sale, ...sales]);

    if (mode==='UPI') {
      if (owner?.upiVpa) {
        const intent = buildUpiIntent({
          pa: owner.upiVpa, pn: owner?.shopName || 'Shop',
          am: totals.grandTotal.toFixed(2), tn: `Order ${sale.invoiceNo}`
        });
        setUpiIntent(intent);
        // Generate QR data URL
        QRCode.toDataURL(intent, { margin:1, width: 256 }, (err, url)=>{
          if (!err) setQrDataUrl(url);
        });
      } else {
        alert('No UPI VPA in Settings; please add one to enable UPI QR.');
      }
    } else {
      alert(`Sale completed. Invoice ${sale.invoiceNo}`);
      clearCart();
    }
  };

  return (
    <div className="content">
      <div className="page">
        <h2>Billing</h2>
        <div className="row between panel" style={{marginBottom:12}}>
          <input placeholder="Search products" value={query} onChange={e=>setQuery(e.target.value)} />
          <div className="mono">Default GST: {(owner?.defaultGstRate*100||18).toFixed(0)}%</div>
        </div>

        <div className="grid" style={{gridTemplateColumns: '2fr 1fr', gap: '12px'}}>
          <div className="panel">
            <h3>Products</h3>
            <div className="grid products" style={{marginTop:8}}>
              {filtered.map(p=>(
                <div className="card" key={p.id}>
                  <div className="name">{p.name}</div>
                  <div className="mono">{p.category}</div>
                  <div className="row" style={{justifyContent:'space-between', marginTop:6}}>
                    <div>{formatINR(p.price)}</div>
                    <div>Stock: {p.stock} {p.stock<5 && <span className="badge">Low</span>}</div>
                  </div>
                  <button style={{marginTop:8}} disabled={p.stock<=0} onClick={()=>addToCart(p)}>{p.stock<=0?'Out of Stock':'Add'}</button>
                </div>
              ))}
              {!filtered.length && <div className="mono">No products found.</div>}
            </div>
          </div>

          <div className="panel">
            <h3>Cart</h3>
            <table className="table">
              <thead><tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th><th></th></tr></thead>
              <tbody>
                {cart.map(l=>(
                  <tr key={l.product.id}>
                    <td>{l.product.name}</td>
                    <td><input type="number" min="1" value={l.qty} onChange={e=>setQty(l.product.id, e.target.value)} style={{width:80}} /></td>
                    <td>{formatINR(l.overridePrice ?? l.product.price)}</td>
                    <td>{formatINR((l.overridePrice ?? l.product.price)*l.qty)}</td>
                    <td><button onClick={()=>removeLine(l.product.id)}>X</button></td>
                  </tr>
                ))}
                {!cart.length && <tr><td colSpan="5">No items</td></tr>}
              </tbody>
            </table>
            <hr />
            <div className="row" style={{justifyContent:'space-between'}}>
              <div>Sub Total: <b>{formatINR(totals.subTotal)}</b></div>
              <div>GST: <b>{formatINR(totals.gst)}</b></div>
              <div>Grand Total: <b>{formatINR(totals.grandTotal)}</b></div>
            </div>
            <div className="row" style={{marginTop:8}}>
              <label>Payment Mode</label>
              <select value={mode} onChange={e=>{setMode(e.target.value); setQrDataUrl(null); setUpiIntent(null);}}>
                <option value="CASH">Cash</option>
                <option value="UPI">UPI</option>
              </select>
              <button disabled={!cart.length} onClick={checkout}>Checkout</button>
            </div>

            {(qrDataUrl || upiIntent) && (
              <div className="panel" style={{marginTop:12}}>
                <h3>Scan to Pay (UPI)</h3>
                {qrDataUrl ? <img src={qrDataUrl} width="240" height="240" alt="UPI QR" /> : null}
                {upiIntent ? <div className="mono" style={{marginTop:8}}>{upiIntent}</div> : null}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

function Reports({ sales }) {
  const [range, setRange] = React.useState('daily');

  const filtered = React.useMemo(()=>{
    if (range==='daily') return sales.filter(s => isSameDay(s.date, todayISO()));
    if (range==='weekly') return sales.filter(s => isInLastNDays(s.date, 7));
    if (range==='monthly') return sales.filter(s => isInLastNDays(s.date, 31));
    return sales;
  }, [sales, range]);

  const total = filtered.reduce((a,s)=>a+s.totals.grandTotal,0);
  const items = filtered.reduce((a,s)=>a+s.lines.reduce((x,l)=>x+l.qty,0),0);
  const gst = filtered.reduce((a,s)=>a+s.totals.gst,0);

  const toCSV = () => {
    const rows = [
      ['Invoice','Date','Item','Qty','Price','GST%','Line Total','Payment'],
    ];
    filtered.forEach(s=>{
      s.lines.forEach(l=>{
        rows.push([
          s.invoiceNo, s.date, l.name, l.qty, l.price, (l.gstRate*100).toFixed(0)+'%', (l.price*l.qty*(1+l.gstRate)).toFixed(2), s.paymentMode
        ]);
      });
    });
    rows.push([]);
    rows.push(['Totals','','','', '', 'GST', gst.toFixed(2), '']);
    rows.push(['', '', '', '', '', 'Grand Total', total.toFixed(2), '']);
    const csv = rows.map(r=>r.map(x=>`"${String(x).replaceAll('"','""')}"`).join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = `sales_${range}.csv`; a.click();
    URL.revokeObjectURL(url);
  };

  return (
    <div className="content">
      <div className="page">
        <h2>Reports</h2>
        <div className="row panel">
          <select value={range} onChange={e=>setRange(e.target.value)}>
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
          <button onClick={toCSV}>Download CSV</button>
        </div>
        <div className="panel">
          <div>Total Sales: <b>{formatINR(total)}</b></div>
          <div>Total Items: <b>{items}</b></div>
          <div>GST Collected: <b>{formatINR(gst)}</b></div>
        </div>
        <div className="mono" style={{marginTop:8}}>
          Note: CSV opens in Excel; a native .xlsx export typically requires a backend or heavy client libraries.
        </div>
      </div>
    </div>
  );
}

function Settings({ owner, setOwner }) {
  const [form,setForm] = React.useState({
    shopName: owner.shopName || '',
    phone: owner.phone || '',
    gstNumber: owner.gstNumber || '',
    defaultGstRate: owner.defaultGstRate ?? 0.18,
    upiVpa: owner.upiVpa || ''
  });
  const onSubmit = (e) => {
    e.preventDefault();
    setOwner({ ...owner, ...form, defaultGstRate: Number(form.defaultGstRate) });
    alert('Saved');
  };

  return (
    <div className="content">
      <div className="page">
        <h2>Settings</h2>
        <form className="panel form" onSubmit={onSubmit}>
          <input placeholder="Shop Name" value={form.shopName} onChange={e=>setForm({...form, shopName: e.target.value})} />
          <input placeholder="Phone" value={form.phone} onChange={e=>setForm({...form, phone: e.target.value})} />
          <input placeholder="GST Number" value={form.gstNumber} onChange={e=>setForm({...form, gstNumber: e.target.value})} />
          <label>Default GST Rate</label>
          <select value={form.defaultGstRate} onChange={e=>setForm({...form, defaultGstRate: Number(e.target.value)})}>
            <option value={0.05}>5%</option>
            <option value={0.18}>18%</option>
            <option value={0.40}>40% (sin/luxury)</option>
          </select>
          <input placeholder="UPI VPA (e.g., shop@upi)" value={form.upiVpa} onChange={e=>setForm({...form, upiVpa: e.target.value})} />
          <div className="row end"><button type="submit">Save</button></div>
        </form>
        <div className="panel">
          <div className="mono">GST defaults reflect current simplified slabs; override per product where HSN demands a different rate.</div>
        </div>
      </div>
    </div>
  );
}

/* ====== Root App ====== */
function App() {
  const { owner, setOwner, products, setProducts, sales, setSales, auth, setAuth } = useDb();
  const [route, setRoute] = React.useState('dashboard');

  // Seed sample data once if empty
  React.useEffect(()=>{
    if (!products.length) {
      setProducts([
        { id:1, name:'Bread Loaf', category:'Bakery', price:45, stock:12 },
        { id:2, name:'Milk 500ml', category:'Groceries', price:28, stock:20 },
        { id:3, name:'Chips Pack', category:'Food & Beverages', price:20, stock:6 },
        { id:4, name:'Toothpaste', category:'Personal Care', price:95, stock:8 },
        { id:5, name:'Chocolate', category:'Food & Beverages', price:50, stock:3 }
      ]);
    }
  // eslint-disable-next-line
  },[]);

  const onLogin = ({phone, password}) => { setAuth({ isAuthed: true, phone }); };

  if (!auth.isAuthed) return <Login onLogin={onLogin} />;

  return (
    <>
      <TopNav route={route} setRoute={setRoute} shopName={owner.shopName} />
      {route==='dashboard' && <Dashboard sales={sales} />}
      {route==='products' && <Products products={products} setProducts={setProducts} />}
      {route==='billing' && <Billing owner={owner} products={products} setProducts={setProducts} sales={sales} setSales={setSales} />}
      {route==='reports' && <Reports sales={sales} />}
      {route==='settings' && <Settings owner={owner} setOwner={setOwner} />}
      <footer>
        Smart Kiosk Demo • Data persists in browser storage • Use Settings to configure shop, GST, and UPI VPA
      </footer>
    </>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
